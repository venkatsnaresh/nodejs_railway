Here's the **Subscription & Payment API Documentation** with clear endpoint descriptions, request/response examples, and Postman testing details. ğŸš€  

---

# **ğŸ“œ Subscription & Payment API Documentation**

## **ğŸ“Œ Base URL:**  
```
http://localhost:3000/subscriptions
```

## **ğŸ”¹ Endpoints Overview**  

| HTTP Method | Endpoint         | Description                                | Authentication |
|------------|-----------------|--------------------------------------------|---------------|
| `GET`      | `/check`        | Check user's subscription status          | âŒ No Auth    |
| `POST`     | `/subscribe`    | Initiate a new subscription & payment     | âŒ No Auth    |
| `POST`     | `/webhook`      | Razorpay webhook for payment updates      | âœ… Webhook Secret |

---

## **ğŸŸ¢ Check Subscription Status**
**ğŸ”¹ Endpoint:**  
```http
GET /subscriptions/check
```

**ğŸ”¹ Query Parameters**
| Parameter | Type   | Description                  |
|-----------|--------|-----------------------------|
| `user_id` | String | ID of the user to check |

**ğŸ”¹ Example Request**
```http
GET /subscriptions/check?user_id=123
```

**ğŸ”¹ Response (Active Subscription)**
```json
{
  "user_id": "123",
  "order_id": "order_ABC123",
  "amount": 500,
  "status": "active"
}
```

**ğŸ”¹ Response (Inactive Subscription)**
```json
{
  "status": "inactive"
}
```

ğŸ“Œ **Testing in Postman:**  
- **Method:** `GET`  
- **URL:** `http://localhost:3000/subscriptions/check?user_id=123`  
- **Expected:** Returns subscription details if active, else `inactive`.

---

## **ğŸ”µ Subscribe & Initiate Payment**
**ğŸ”¹ Endpoint:**  
```http
POST /subscriptions/subscribe
```

**ğŸ”¹ Request Body (JSON)**
```json
{
  "user_id": "123",
  "amount": 500
}
```

**ğŸ”¹ Response (Success)**
```json
{
  "order_id": "order_ABC123",
  "amount": 500,
  "status": "pending"
}
```

ğŸ“Œ **What Happens?**
1. Razorpay generates an **Order ID**.
2. This order ID is stored in the database with **pending** status.
3. User is redirected to complete the payment.

ğŸ“Œ **Testing in Postman:**  
- **Method:** `POST`  
- **URL:** `http://localhost:3000/subscriptions/subscribe`  
- **Body:** Select **raw JSON**, enter user ID and amount.  
- **Expected:** Order ID is generated, payment is initiated.

---

## **ğŸŸ  Razorpay Webhook - Handle Payment Updates**
**ğŸ”¹ Endpoint:**  
```http
POST /subscriptions/webhook
```

ğŸ“Œ **Purpose:**  
Razorpay sends payment updates to this webhook, verifying transactions and updating the subscription status.

**ğŸ”¹ Request Headers**
| Header | Value |
|--------|-------|
| `x-razorpay-signature` | (Generated by Razorpay) |

**ğŸ”¹ Example Webhook Payload (From Razorpay)**
```json
{
  "event": "payment.captured",
  "payload": {
    "payment": {
      "entity": {
        "id": "pay_ABC123",
        "order_id": "order_ABC123",
        "amount": 50000,
        "currency": "INR",
        "status": "captured"
      }
    }
  }
}
```

**ğŸ”¹ Response (Success)**
```json
{
  "message": "Subscription activated"
}
```

ğŸ“Œ **What Happens?**
1. Razorpay sends a payment update (event = `payment.captured`).
2. The API verifies the **signature**.
3. If valid, the **subscription status is updated to active** in the database.

ğŸ“Œ **Testing in Postman:**  
- **Method:** `POST`  
- **URL:** `http://localhost:3000/subscriptions/webhook`  
- **Headers:**  
  - Add `x-razorpay-signature` (fake for testing).  
- **Body:** Enter Razorpay payload in **raw JSON**.  
- **Expected:** Subscription status updates to **active**.

---

## **ğŸ› ï¸ Additional Improvements**
- âœ… **JWT Authentication** to secure user-specific routes.  
- ğŸ“… **Subscription Expiry Handling** with renewal notifications.  
- ğŸ”” **Email Alerts** on successful subscription activation.  

Let me know if you need modifications! ğŸ˜Š