Here's the **Subscription & Payment API Documentation** with clear endpoint descriptions, request/response examples, and Postman testing details. 🚀  

---

# **📜 Subscription & Payment API Documentation**

## **📌 Base URL:**  
```
http://localhost:3000/subscriptions
```

## **🔹 Endpoints Overview**  

| HTTP Method | Endpoint         | Description                                | Authentication |
|------------|-----------------|--------------------------------------------|---------------|
| `GET`      | `/check`        | Check user's subscription status          | ❌ No Auth    |
| `POST`     | `/subscribe`    | Initiate a new subscription & payment     | ❌ No Auth    |
| `POST`     | `/webhook`      | Razorpay webhook for payment updates      | ✅ Webhook Secret |

---

## **🟢 Check Subscription Status**
**🔹 Endpoint:**  
```http
GET /subscriptions/check
```

**🔹 Query Parameters**
| Parameter | Type   | Description                  |
|-----------|--------|-----------------------------|
| `user_id` | String | ID of the user to check |

**🔹 Example Request**
```http
GET /subscriptions/check?user_id=123
```

**🔹 Response (Active Subscription)**
```json
{
  "user_id": "123",
  "order_id": "order_ABC123",
  "amount": 500,
  "status": "active"
}
```

**🔹 Response (Inactive Subscription)**
```json
{
  "status": "inactive"
}
```

📌 **Testing in Postman:**  
- **Method:** `GET`  
- **URL:** `http://localhost:3000/subscriptions/check?user_id=123`  
- **Expected:** Returns subscription details if active, else `inactive`.

---

## **🔵 Subscribe & Initiate Payment**
**🔹 Endpoint:**  
```http
POST /subscriptions/subscribe
```

**🔹 Request Body (JSON)**
```json
{
  "user_id": "123",
  "amount": 500
}
```

**🔹 Response (Success)**
```json
{
  "order_id": "order_ABC123",
  "amount": 500,
  "status": "pending"
}
```

📌 **What Happens?**
1. Razorpay generates an **Order ID**.
2. This order ID is stored in the database with **pending** status.
3. User is redirected to complete the payment.

📌 **Testing in Postman:**  
- **Method:** `POST`  
- **URL:** `http://localhost:3000/subscriptions/subscribe`  
- **Body:** Select **raw JSON**, enter user ID and amount.  
- **Expected:** Order ID is generated, payment is initiated.

---

## **🟠 Razorpay Webhook - Handle Payment Updates**
**🔹 Endpoint:**  
```http
POST /subscriptions/webhook
```

📌 **Purpose:**  
Razorpay sends payment updates to this webhook, verifying transactions and updating the subscription status.

**🔹 Request Headers**
| Header | Value |
|--------|-------|
| `x-razorpay-signature` | (Generated by Razorpay) |

**🔹 Example Webhook Payload (From Razorpay)**
```json
{
  "event": "payment.captured",
  "payload": {
    "payment": {
      "entity": {
        "id": "pay_ABC123",
        "order_id": "order_ABC123",
        "amount": 50000,
        "currency": "INR",
        "status": "captured"
      }
    }
  }
}
```

**🔹 Response (Success)**
```json
{
  "message": "Subscription activated"
}
```

📌 **What Happens?**
1. Razorpay sends a payment update (event = `payment.captured`).
2. The API verifies the **signature**.
3. If valid, the **subscription status is updated to active** in the database.

📌 **Testing in Postman:**  
- **Method:** `POST`  
- **URL:** `http://localhost:3000/subscriptions/webhook`  
- **Headers:**  
  - Add `x-razorpay-signature` (fake for testing).  
- **Body:** Enter Razorpay payload in **raw JSON**.  
- **Expected:** Subscription status updates to **active**.

---

## **🛠️ Additional Improvements**
- ✅ **JWT Authentication** to secure user-specific routes.  
- 📅 **Subscription Expiry Handling** with renewal notifications.  
- 🔔 **Email Alerts** on successful subscription activation.  

Let me know if you need modifications! 😊